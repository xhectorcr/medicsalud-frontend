<div class="app-container">
  <app-sidebaradmin></app-sidebaradmin>

  <main class="main-content" style="margin-left: 260px; padding: 20px;">
    <div class="patients-container">
      <div class="header">
        <div class="title-section">
          <h1>Gesti√≥n de Pacientes</h1>
          <p class="subtitle">Administra la informaci√≥n de tus pacientes</p>
        </div>
        <button class="btn-primary" (click)="openCreateModal()">
          <span class="icon">+</span>
          Nuevo Paciente
        </button>
      </div>

      <div class="search-section">
        <div class="search-box">
          <span class="search-icon">üîç</span>
          <input
            type="text"
            placeholder="Buscar por nombre, DNI o email..."
            [(ngModel)]="searchTerm"
            (input)="filterPatients()"
            class="search-input"
          />
        </div>
        <div class="stats">
          <span class="stat-item">
            <span class="stat-label">Total:</span>
            <span class="stat-value">{{ patients.length }}</span>
          </span>
          <span class="stat-item">
            <span class="stat-label">Activos:</span>
            <span class="stat-value success">
              {{ activePatientsCount }}
            </span>
          </span>
        </div>
      </div>

      <div class="table-container">
        <table class="patients-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Nombre de usuario</th>
              <th>DNI</th>
              <th>Email</th>
              <th>Tel√©fono</th>
              <th>Rol</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let patient of filteredPatients">
              <td>
                <span class="id-badge">#{{ patient.id }}</span>
              </td>

              <td class="name-cell">
                <strong>{{ patient.nombreUsuario }}</strong>
              </td>

              <td>{{ patient.dni }}</td>
              <td class="email-cell">{{ patient.email }}</td>
              <td>{{ patient.telefono }}</td>
              <td>{{ patient.rol }}</td>

              <td>
                <span
                  class="status-badge"
                  [class.active]="patient.estado"
                  [class.inactive]="!patient.estado"
                  (click)="toggleStatus(patient)"
                >
                  {{ patient.estado ? 'Activo' : 'Inactivo' }}
                </span>
              </td>

              <td class="actions-cell">
                <button
                  class="btn-icon btn-edit"
                  (click)="openEditModal(patient)"
                  title="Editar"
                >
                  ‚úèÔ∏è
                </button>
                <button
                  class="btn-icon btn-delete"
                  (click)="openDeleteModal(patient)"
                  title="Eliminar"
                >
                  üóëÔ∏è
                </button>
              </td>
            </tr>

            <tr *ngIf="filteredPatients.length === 0">
              <td colspan="8" class="no-results">
                No se encontraron pacientes
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Modal Crear/Editar -->
      <div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
        <div class="modal" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h2>
              {{ modalMode === 'create' ? 'Nuevo Paciente' : 'Editar Paciente' }}
            </h2>
            <button class="btn-close" (click)="closeModal()">√ó</button>
          </div>

          <div class="modal-body">
            <form>
              <div class="form-row">
                <div class="form-group">
                  <label>Nombre de usuario *</label>
                  <input
                    type="text"
                    [(ngModel)]="patientForm.nombreUsuario"
                    name="nombreUsuario"
                    placeholder="Nombre del paciente"
                    required
                  />
                </div>
                <div class="form-group">
                  <label>DNI *</label>
                  <input
                    type="text"
                    [(ngModel)]="patientForm.dni"
                    name="dni"
                    placeholder="12345678"
                    required
                  />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>Email *</label>
                  <input
                    type="email"
                    [(ngModel)]="patientForm.email"
                    name="email"
                    placeholder="ejemplo@email.com"
                    required
                  />
                </div>
                <div class="form-group">
                  <label>Tel√©fono *</label>
                  <input
                    type="tel"
                    [(ngModel)]="patientForm.telefono"
                    name="telefono"
                    placeholder="925XXXXXX"
                    required
                  />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>Rol</label>
                  <input
                    type="text"
                    [(ngModel)]="patientForm.rol"
                    name="rol"
                    placeholder="PACIENTE"
                  />
                </div>
                <div class="form-group">
                  <label>Estado</label>
                  <select [(ngModel)]="patientForm.estado" name="estado">
                    <option [ngValue]="true">Activo</option>
                    <option [ngValue]="false">Inactivo</option>
                  </select>
                </div>
              </div>
            </form>
          </div>

          <div class="modal-footer">
            <button class="btn-secondary" (click)="closeModal()">
              Cancelar
            </button>
            <button class="btn-primary" (click)="savePatient()">
              {{ modalMode === 'create' ? 'Crear Paciente' : 'Guardar Cambios' }}
            </button>
          </div>
        </div>
      </div>

      <!-- Modal Eliminar -->
      <div
        class="modal-overlay"
        *ngIf="showDeleteModal"
        (click)="closeDeleteModal()"
      >
        <div class="modal modal-delete" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h2>Confirmar Eliminaci√≥n</h2>
            <button class="btn-close" (click)="closeDeleteModal()">√ó</button>
          </div>

          <div class="modal-body">
            <div class="delete-warning">
              <span class="warning-icon">‚ö†Ô∏è</span>
              <p>
                ¬øEst√°s seguro de que deseas eliminar al paciente
                <strong>{{ patientToDelete?.nombreUsuario }}</strong>?
              </p>
              <p class="warning-text">Esta acci√≥n no se puede deshacer.</p>
            </div>
          </div>

          <div class="modal-footer">
            <button class="btn-secondary" (click)="closeDeleteModal()">
              Cancelar
            </button>
            <button class="btn-danger" (click)="confirmDelete()">
              Eliminar Paciente
            </button>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
